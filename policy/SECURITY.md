# Security Policy

For a consolidated security overview, see `docs/security/overview.md`.

## Supported Images

Tag | Supported
--- | ---
chainguard-jdk25 | ✅
chainguard-jdk26ea | ✅
chainguard-jdk26valhalla | ✅
distroless-jre25 | ✅
distroless-jre26ea | ✅
distroless-jre26valhalla | ✅
ubi9-jdk25 | ✅
ubi9-jdk26ea | ✅
ubi9-jdk26valhalla | ✅

## Reporting a Vulnerability

Please open a security advisory via GitHub or email security@artagon.dev with:
- Affected tag and digest
- Vulnerability description, severity, and CVE
- Reproduction steps, logs, and SBOM entry if possible

## CVE Response SLA

We are committed to timely vulnerability remediation:

**CRITICAL Severity**:
- **Acknowledgment**: Within 24 hours
- **Patched image**: Within 72 hours
- **Security advisory**: Posted to GitHub Security Advisories

**HIGH Severity**:
- **Acknowledgment**: Within 48 hours
- **Patched image**: Within 1 week
- **Tracking issue**: Created for remediation progress

**MEDIUM/LOW Severity**:
- **Acknowledgment**: Within 1 week
- **Patched image**: Included in next scheduled release

**Base Image CVEs**: For vulnerabilities in upstream base images (Chainguard, Distroless, UBI9) outside our control, we document the issue and upstream status, provide alternative mitigations if available, and notify users via release notes.

## Security Features

All container images include the following security hardening:

### Runtime Security
- **Non-root user**: UID 65532 (Kubernetes "nobody" convention)
- **Read-only rootfs**: Images support `--read-only` with tmpfs mounts
- **No capabilities**: Images require zero Linux capabilities
- **Health checks**: HEALTHCHECK instructions for orchestration

### Security Profiles
- **Seccomp**: `security/seccomp-java.json` - Restricts syscalls to Java essentials
- **AppArmor**: `security/apparmor-java.txt` - Restricts filesystem access

### Supply Chain Security
- **Cosign signatures**: Keyless signing with Rekor transparency log
- **SBOM attestations**: CycloneDX format generated by Syft
- **SLSA provenance**: Level 3 provenance with GitHub Actions attestation
- **In-toto attestations**: JDK resolution, SBOM metadata, and scan summaries
- **Digest pinning**: Base images pinned by SHA256 digest

### OCI Labels
Images include security metadata labels:
- `org.opencontainers.image.security.capabilities`: "NONE"
- `org.opencontainers.image.security.readonly-rootfs`: "recommended"
- `org.opencontainers.image.security.seccomp`: Reference to seccomp profile

## Hardening Guidance

### Docker

```bash
docker run --rm \
  --read-only --tmpfs /tmp:rw,exec,nosuid,nodev \
  --security-opt no-new-privileges:true \
  --security-opt seccomp=security/seccomp-java.json \
  --cap-drop=ALL \
  -v "$(pwd)/app:/workspace:ro" \
  ghcr.io/artagon/artagon-containers:chainguard-jdk25 \
  java -jar /workspace/app.jar
```

### Kubernetes

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: secure-java-app
spec:
  securityContext:
    runAsNonRoot: true
    runAsUser: 65532
    runAsGroup: 65532
    fsGroup: 65532
  containers:
  - name: app
    image: ghcr.io/artagon/artagon-containers:distroless-jre25
    securityContext:
      readOnlyRootFilesystem: true
      allowPrivilegeEscalation: false
      capabilities:
        drop: [ALL]
    volumeMounts:
    - name: tmp
      mountPath: /tmp
  volumes:
  - name: tmp
    emptyDir: {}
```

### AppArmor Profile (Linux hosts)

```bash
# Load profile on host
sudo apparmor_parser -r security/apparmor-java.txt

# Verify profile loaded
aa-status | grep -q artagon-java && echo 'Profile loaded' || echo 'Profile not found'

# Use in Docker
docker run --security-opt apparmor=artagon-java <image>

# Use in Kubernetes
# Add annotation: container.apparmor.security.beta.kubernetes.io/<container-name>: localhost/artagon-java
```

## Verification

```bash
scripts/verify_supply_chain.sh ghcr.io/artagon/artagon-containers:chainguard-jdk25
```

### Verify Image Signature

```bash
COSIGN_EXPERIMENTAL=1 cosign verify \
  ghcr.io/artagon/artagon-containers:chainguard-jdk25
```

### Download and Inspect SBOM

```bash
cosign download sbom ghcr.io/artagon/artagon-containers:distroless-jre25 > sbom.json
syft scan --input sbom.json
```

### Verify SLSA Provenance

```bash
cosign verify-attestation --type slsaprovenance \
  ghcr.io/artagon/artagon-containers:ubi9-jdk25
```

### Independent Vulnerability Scan

```bash
trivy image ghcr.io/artagon/artagon-containers:chainguard-jdk25
grype ghcr.io/artagon/artagon-containers:chainguard-jdk25
```

## Compliance Framework Mapping

Our security hardening aligns with industry frameworks:

### CIS Docker Benchmark
- Non-root user → CIS 4.1
- Read-only rootfs → CIS 5.12
- Seccomp profile → CIS 5.21
- Capabilities dropped → CIS 5.3
- No new privileges → CIS 5.25

### NIST SP 800-190
- Image security (Section 4.1)
- Container runtime security (Section 4.2)
- Supply chain security (Section 4.4)

### Regulatory Compliance
- **HIPAA**: SBOM and provenance for audit trails
- **PCI-DSS**: Vulnerability scanning and patching SLA
- **FedRAMP**: SLSA Level 3 provenance, continuous monitoring

## FIPS 140-3 Roadmap

Planned work to support FIPS 140-3 aligned deployments:
- Add UBI FIPS base variants for JVM images (FIPS-enabled crypto modules)
- Validate JVM crypto providers in FIPS mode and document supported configurations
- Provide deployment guidance and verification steps for FIPS-enabled runtimes

## Security Testing

All images undergo:
- **Vulnerability scanning**: Trivy and Grype with HIGH/CRITICAL gates
- **SBOM generation**: CycloneDX format with package inventory
- **Runtime testing**: Validated with read-only rootfs and security profiles
- **Nightly scans**: Continuous monitoring for new CVEs

## Additional Resources

- [Seccomp Profile Usage](../docs/security/seccomp.md)
- [AppArmor Profile Usage](../docs/security/apparmor.md)
- [Secure Deployment Guide](../docs/security/deployment.md)
- [Supply Chain Policy](SUPPLY-CHAIN.md)
